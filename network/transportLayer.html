<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>概述 | FFFXUE</title>
    <meta name="description" content="开发笔记">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/notes/flag.ico">
    
    <link rel="preload" href="/notes/assets/css/0.styles.f3b51880.css" as="style"><link rel="preload" href="/notes/assets/js/app.a41b94f8.js" as="script"><link rel="preload" href="/notes/assets/js/2.c52a3321.js" as="script"><link rel="preload" href="/notes/assets/js/25.37819e9d.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.d40410d8.js"><link rel="prefetch" href="/notes/assets/js/11.368d85aa.js"><link rel="prefetch" href="/notes/assets/js/12.041c7eab.js"><link rel="prefetch" href="/notes/assets/js/13.b16d6551.js"><link rel="prefetch" href="/notes/assets/js/14.8a0a33d8.js"><link rel="prefetch" href="/notes/assets/js/15.b1f74293.js"><link rel="prefetch" href="/notes/assets/js/16.2b45b17b.js"><link rel="prefetch" href="/notes/assets/js/17.ba8bc991.js"><link rel="prefetch" href="/notes/assets/js/18.5522bf27.js"><link rel="prefetch" href="/notes/assets/js/19.5ef2994f.js"><link rel="prefetch" href="/notes/assets/js/20.bd1387b2.js"><link rel="prefetch" href="/notes/assets/js/21.49cd2783.js"><link rel="prefetch" href="/notes/assets/js/22.015468ac.js"><link rel="prefetch" href="/notes/assets/js/23.f8a0f975.js"><link rel="prefetch" href="/notes/assets/js/24.2bc3eae7.js"><link rel="prefetch" href="/notes/assets/js/26.3c7d5bfe.js"><link rel="prefetch" href="/notes/assets/js/27.b58d79b7.js"><link rel="prefetch" href="/notes/assets/js/28.dcf04f1f.js"><link rel="prefetch" href="/notes/assets/js/29.afebf154.js"><link rel="prefetch" href="/notes/assets/js/3.5e110c6a.js"><link rel="prefetch" href="/notes/assets/js/4.b0dd307f.js"><link rel="prefetch" href="/notes/assets/js/5.80900f81.js"><link rel="prefetch" href="/notes/assets/js/6.11c4bab6.js"><link rel="prefetch" href="/notes/assets/js/7.e0955c7f.js"><link rel="prefetch" href="/notes/assets/js/8.16f41505.js"><link rel="prefetch" href="/notes/assets/js/9.b1625156.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.f3b51880.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">FFFXUE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/algorithm/" class="nav-link">
  算法与数据结构
</a></div><div class="nav-item"><a href="/notes/network/" class="nav-link router-link-active">
  计算机网络
</a></div><div class="nav-item"><a href="/notes/designPatterns/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web系列" class="dropdown-title"><span class="title">Web系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/webSecurity/client/" class="nav-link">
  Web安全
</a></li><li class="dropdown-item"><!----> <a href="/notes/browser/" class="nav-link">
  浏览器工作原理与实践
</a></li><li class="dropdown-item"><!----> <a href="/notes/kit/bundler/" class="nav-link">
  玩具工具包
</a></li></ul></div></div> <a href="https://github.com/hakuna-tata/notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/algorithm/" class="nav-link">
  算法与数据结构
</a></div><div class="nav-item"><a href="/notes/network/" class="nav-link router-link-active">
  计算机网络
</a></div><div class="nav-item"><a href="/notes/designPatterns/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web系列" class="dropdown-title"><span class="title">Web系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/webSecurity/client/" class="nav-link">
  Web安全
</a></li><li class="dropdown-item"><!----> <a href="/notes/browser/" class="nav-link">
  浏览器工作原理与实践
</a></li><li class="dropdown-item"><!----> <a href="/notes/kit/bundler/" class="nav-link">
  玩具工具包
</a></li></ul></div></div> <a href="https://github.com/hakuna-tata/notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>计算机网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/network/" class="sidebar-link">概述</a></li><li><a href="/notes/network/networkLayer.html" class="sidebar-link">网络层</a></li><li><a href="/notes/network/transportLayer.html" class="active sidebar-link">传输层</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/network/transportLayer.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/notes/network/transportLayer.html#udp-协议和-tcp-协议" class="sidebar-link">UDP 协议和 TCP 协议</a></li><li class="sidebar-sub-header"><a href="/notes/network/transportLayer.html#udp-首部和-tcp-首部" class="sidebar-link">UDP 首部和 TCP 首部</a></li><li class="sidebar-sub-header"><a href="/notes/network/transportLayer.html#tcp-的传输连接管理" class="sidebar-link">TCP 的传输连接管理</a></li><li class="sidebar-sub-header"><a href="/notes/network/transportLayer.html#可靠传输的工作原理" class="sidebar-link">可靠传输的工作原理</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>传输层为 <em><strong>应用程序之间</strong></em> 提供 <em><strong>端到端</strong></em> 的逻辑通信。</p> <h2 id="udp-协议和-tcp-协议"><a href="#udp-协议和-tcp-协议" class="header-anchor">#</a> UDP 协议和 TCP 协议</h2> <ol><li><strong>UDP（User Datagram Protocol）</strong></li></ol> <blockquote><p>UDP 是无连接的 （即不需要建立连接，减少了开销和发送数据的时延）<br>
UDP 不提供可靠交付（即不需要维护复杂的连接状态）<br>
UDP 是面向报文传输的（即应用层交给 UDP 多长的报文，UDP就照样发送）<br>
UDP 支持 N 对 N 的交互通信<br>
.....</p></blockquote> <ol start="2"><li><strong>TCP（Transmission Control Protocol）</strong></li></ol> <blockquote><p>TCP 是面向连接的（即TCP三次握手）<br>
TCP 提供可靠交付（即传输的数据无差错、不丢失、不重复）<br>
TCP 一条连接只能连接通信两端唯一的端点（即套接字：IP + port）<br>
TCP 面向字节流传输（即把数据拆分成一连串无结构的字节流）<br>
TCP 提供全双工通信（即通信双方在任何时候都能发送数据）<br>
......</p></blockquote> <h2 id="udp-首部和-tcp-首部"><a href="#udp-首部和-tcp-首部" class="header-anchor">#</a> UDP 首部和 TCP 首部</h2> <ol><li><p><strong>UDP数据报：（首部字段 + 数据字段）</strong></p> <img src="/notes/network/transportLayer/udp.png" style="display:block;margin:0 auto;"> <ul><li>比较清晰明了不需要做笔记</li></ul></li> <li><p><strong>TCP报文段：（首部字段 + 数据字段）</strong></p> <img src="/notes/network/transportLayer/tcp.png" style="display:block;margin:0 auto;"> <ul><li>序号（Sequence number）：是指本报文段第一个字节的序号，TCP连接中传送的字节流中的每一个字节都按顺序编号，主要是为了保证数据包按正确的顺序组装。</li> <li>确认号（Acknowledgment number）：是期望收到对方下一个报文段的第一个数据字节的序号。</li> <li>常用标记位：
<ul><li>1.确认ACK: 当 ACK = 1时确认号字段才有效。也就是建立连接后传送报文段都必须把 ACK = 1。</li> <li>2.同步SYN: 建立一个连接时用来同步的序号。当 SYN = 1 而 ACK = 0表明是连接请求报文，当同意建立连接则在响应报文中使 SYN = 1 和 ACK = 1。</li> <li>3.终止FIN：用来释放一个连接。当 FIN = 1表明此报文段的发送方的数据都已经发送完毕，并要求释放传输连接。</li></ul></li> <li>窗口大小：窗口值告诉对方目前允许对方发送的数据量。是因为双方的接收缓存空间是有限的。</li> <li>常用的选项：
<ul><li>1.TimeStamp：TCP 时间戳。</li> <li>2.MSS: 规定一个最大报文段长度。</li> <li>3.SACK: 选择确认选项。</li> <li>4.Window Scale： 窗口缩放选项。</li></ul></li></ul></li></ol> <h2 id="tcp-的传输连接管理"><a href="#tcp-的传输连接管理" class="header-anchor">#</a> TCP 的传输连接管理</h2> <ol><li><p><strong>TCP 的三次握手连接</strong> <img src="/notes/network/transportLayer/handshake.jpg" style="display:block;margin:0 auto;"></p> <ul><li>双方开始都处于 <strong>CLOSED</strong> 状态。服务端开始监听某个端口，进入了 <strong>LISTEN</strong> 状态。</li> <li>客户端主动发起连接，请求报文段中把首部的<strong>SYN位 置为1</strong>，自己变成 <strong>SYN-SENT</strong> 状态。【不能携带数据】</li> <li>服务端收到连接请求后，如果同意建立连接则向客户端发送确认。确认报文段中把首部的 <strong>SYN位 和 ACK位 置为1</strong>，自己变成 <strong>SYN-RCVD</strong> 状态。【不能携带数据】</li> <li>之后客户端再次向服务端给出确认。确认报文段中把 <strong>ACK位 置为1</strong>，自己变为 <strong>ESTABLISHED</strong> 状态。【ACK报文段可以携带数据】</li> <li>服务端接收到客户端确认后，也进入 <strong>ESTABLISHED</strong> 状态。</li></ul> <p><strong>为什么不是二次握手呢？</strong></p> <ul><li>主要是为了防止已失效的连接请求报文段突然又传送给服务段，因为产生错误。</li></ul> <blockquote><p>异常情况：如果客户端发出的一个连接请求报文没有丢失，只是在某些网络结点长时间<strong>滞留</strong>了，直到连接释放后的某个时间才到达服务端。本来这是一个已经失效的报文段，但是服务端会误以为这是客户端发出一次新的连接请求，随后又同意建立连接。所以这就带来了连接资源的浪费了。</p></blockquote> <p><strong>为什么不是四次握手呢？</strong></p> <ul><li>三次握手已经足够确认客户端服务端发送和接收的能力，再多用处就不大了。</li></ul></li> <li><p><strong>TCP 的四次挥手释放</strong> <img src="/notes/network/transportLayer/release.jpg" style="display:block;margin:0 auto;"></p> <ul><li>双方开始都处于 <strong>ESTABLISHED</strong> 状态。</li> <li>客户端主动发出连接释放报文段，把释放报文段中首部的<strong>FIN位 置为1</strong>，自己变成 <strong>FIN-WAIT-1</strong> 状态。</li> <li>服务端收到释放报文段后发出确认，确认报文段中把首部的 <strong>ACK位 置为1</strong>，自己变为 <strong>CLOSE-WAIT</strong> 状态。【半关闭状态，即客户端不向服务端发送数据了】</li> <li>客户端收到服务端的确认后，自己变为 <strong>FIN-WAIT-2</strong> 状态，接着等待服务端发出的连接释放报文段。</li> <li>服务端发出连接释放报文段，把释放报文段中首部的 <strong>FIN 置为1</strong>，自己进入 <strong>LAST-ACK</strong> 状态。</li> <li>客户端接收到释放报文段后发出确认，确认报文段中把首部的 <strong>ACK位 置为1</strong>，自己变为 <strong>TIME-WAIT</strong> 状态。</li> <li>服务端接收到客户端确认后变为 <strong>CLOSED</strong> 状态，而客户端需等待 <strong>2个MSL</strong> 后才进入 <strong>CLOSED</strong> 状态。</li></ul> <p><strong>为什么客户端CLOSED前需等待2MSL（最长报文段寿命）</strong></p> <ul><li><ol><li>为了保证客户端发送的最后一个 <strong>ACK 报文段</strong>能够到达服务端。</li></ol></li></ul> <blockquote><p>异常情况：如果客户端发送的最后这个 ACK 报文段丢失了，就会造成 LAST-ACK 状态的服务端收不到对客户端发送的 FIN + ACK 报文段的确认。服务端就会超时重传这个 FIN + ACK 报文段，如果客户端发送最后一个 ACK 报文段就直接进入 CLOSED 状态就无法接收服务端重传的报文了，服务端就无法按照正常步骤进入 CLOSED 状态。如果有这个等待2MSL，客户端就可以重传一次确认，最后都可以正常进入 CLOSED 状态。</p></blockquote> <ul><li><ol start="2"><li>确保下一个新的连接中不会出现这次连接的报文段。</li></ol></li></ul> <blockquote><p>经过2MSL可以使得本连接持续的时间内所产生的所有报文段都从网络中消失，这样下个新的连接中不会出现这种旧的连接请求报文段。</p></blockquote></li></ol> <h2 id="可靠传输的工作原理"><a href="#可靠传输的工作原理" class="header-anchor">#</a> 可靠传输的工作原理</h2> <ol><li><p><strong>停止等待协议</strong></p></li> <li><p><strong>连续ARQ（Automatic Repeat reQuest）协议</strong></p></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-4-20 11:39:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/network/networkLayer.html" class="prev">
        网络层
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.a41b94f8.js" defer></script><script src="/notes/assets/js/2.c52a3321.js" defer></script><script src="/notes/assets/js/25.37819e9d.js" defer></script>
  </body>
</html>
